---
import Layout from "../layouts/Layout.astro";
import Description from "./Description.md";
import background from "../assets/background.webp";
import backgroundSmall from "../assets/background-800.webp";
import buyTicketsImage from "../assets/buy-tickets.webp";
import type { ImageMetadata } from "astro";

interface Props {
  titleImage: ImageMetadata;
  titleImageSmall: ImageMetadata;
}

const { titleImage, titleImageSmall } = Astro.props;
---

<Layout>
  <script
    type="text/javascript"
    src="https://cdn.qtickets.tech/openapi.js"
    is:inline></script>
  <main class="min-h-screen">
    <!-- Hero Section -->
    <section
      class="relative h-screen min-h-[600px] flex items-center justify-center overflow-hidden px-4"
    >
      <!-- Background Image with Overlay -->
      <div class="absolute inset-0 -z-20">
        <picture>
          <source 
            srcset={backgroundSmall.src} 
            media="(max-width: 768px)"
            type="image/webp"
          />
          <img 
            src={background.src} 
            alt="" 
            width="1024" 
            height="1536"
            class="w-full h-full object-cover" 
            loading="eager"
            decoding="sync"
          />
        </picture>
      </div>

      <!-- Sphere/Title -->
      <div
        class="relative w-full max-w-[600px] flex justify-center items-center group"
      >
        <picture>
          <source 
            srcset={titleImageSmall.src} 
            media="(max-width: 768px)"
            type="image/webp"
          />
          <img
            src={titleImage.src}
            alt="ёлка и сказка"
            width="1024"
            height="1536"
            class="w-full h-auto object-contain drop-shadow-md"
            loading="eager"
            decoding="sync"
          />
        </picture>

        <!-- Button positioned inside the sphere (at the bottom) -->
        <div
          class="absolute bottom-[16%] left-1/2 -translate-x-1/2 z-10 w-48 p-0 hover:scale-105 transition-transform duration-300"
        >
          <a
            href="https://qtickets.ru/event/198955"
            class="qtickets-button qtickets-reset w-full h-auto block p-0 cursor-pointer focus:outline-none"
          >
            <img
              src={buyTicketsImage.src}
              alt="купить билеты"
              width="1536"
              height="1024"
              class="w-full h-auto drop-shadow-sm"
              loading="eager"
              decoding="sync"
            />
          </a>
        </div>
      </div>
    </section>

    <style is:global>
      /* Override injected QTickets styles */
      a.qtickets-button.qtickets-reset {
        background: transparent !important;
        border: none !important;
        /* width: auto !important;  <-- Removed to allow specific sizing */
        height: auto !important;
        border-radius: 100% !important;
        padding: 0 !important;
        margin: 0 !important;
        box-shadow: none !important;
        text-decoration: none !important;
        display: block !important;
        outline: none !important;
        font-size: inherit !important;
        line-height: inherit !important;
        color: inherit !important;
        border-radius: 0 !important;
      }

      /* Specific size for secondary button */
      a.qtickets-button.qtickets-reset.qtickets-secondary {
        width: 150px !important; /* Small but noticeble */
        transition: transform 0.3s ease;
      }

      a.qtickets-button.qtickets-reset.qtickets-secondary:hover {
        transform: scale(1.05);
      }

      /* Also reset hover/focus states */
      a.qtickets-button.qtickets-reset:hover,
      a.qtickets-button.qtickets-reset:focus {
        background: transparent !important;
        border: none !important;
        color: inherit !important;
      }
    </style>

    <!-- Description Section -->
    <section
      class="px-6 pt-12 md:pt-16 pb-6 md:pb-8 bg-paper relative overflow-hidden"
    >
      <!-- Decorative side line -->
      <div
        class="hidden md:block absolute left-12 top-0 h-full w-[1px] bg-sand/20"
      >
      </div>

      <div class="max-w-2xl mx-auto relative">
        <div
          class="prose prose-lg prose-p:font-sans prose-p:text-ink/80 prose-headings:font-serif prose-headings:text-primary prose-headings:font-normal prose-a:text-clay prose-a:no-underline hover:prose-a:underline lowercase"
        >
          <Description />
        </div>
      </div>
    </section>

    <!-- Artists Section -->
    <section class="px-6 pt-6 md:pt-8 pb-24 md:pb-32 bg-paper">
      <div class="max-w-4xl mx-auto">
        <div class="relative inline-block w-full">
          <!-- Badge -->
          <div
            class="absolute -top-6 -right-4 z-10 bg-primary text-paper px-6 py-2 rounded-full font-serif italic text-lg shadow-lg rotate-3 lowercase"
          >
            вот артисты и музыканты
          </div>

          <!-- Secondary Buy Button (Bottom Left Overlay) -->
          <div
            class="absolute -bottom-6 -left-4 z-10 w-40 hover:scale-105 transition-transform duration-300 -rotate-3"
          >
            <a
              href="https://qtickets.ru/event/198955"
              class="qtickets-button qtickets-reset qtickets-secondary block p-0 cursor-pointer focus:outline-none"
            >
            <img
              src={buyTicketsImage.src}
              alt="купить билеты"
              width="1536"
              height="1024"
              class="w-full h-auto drop-shadow-md"
              loading="lazy"
              decoding="async"
            />
            </a>
          </div>

          <div class="relative overflow-hidden rounded-[2rem] shadow-xl group">
            <img
              src="/artists.jpg"
              alt="наши музыканты"
              width="1200"
              height="800"
              class="w-full h-auto grayscale group-hover:grayscale-0 transition-all duration-700 ease-in-out"
              loading="lazy"
              decoding="async"
            />
          </div>
        </div>
      </div>
    </section>

    <!-- Social Links / Footer -->
    <section class="px-6 py-8 bg-primary text-paper text-center">
      <div
        class="max-w-4xl mx-auto flex flex-col md:flex-row justify-between items-center gap-4 text-sm font-sans tracking-wide lowercase opacity-80"
      >
        <div class="flex gap-6">
          <a
            href="https://instagram.com/via_na_prazdnik"
            target="_blank"
            rel="noopener noreferrer"
            class="hover:text-sand transition-colors"
          >
            instagram
          </a>
          <a
            href="https://t.me/povsemmestam"
            target="_blank"
            rel="noopener noreferrer"
            class="hover:text-sand transition-colors"
          >
            telegram
          </a>
        </div>

        <div class="text-paper/60">© 2025 мосмузсин</div>
      </div>
    </section>
  </main>
</Layout>
