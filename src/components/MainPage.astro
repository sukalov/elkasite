---
import Layout from "../layouts/Layout.astro";
import Description from "./Description.md";
import background from "../assets/background.webp";
import backgroundSmall from "../assets/background-800.webp";
import buyTicketsImage from "../assets/buy-tickets.webp";
import SocialIcon from "./SocialIcon.astro";
import type { ImageMetadata } from "astro";

interface Props {
  titleImage: ImageMetadata;
  titleImageSmall: ImageMetadata;
}

const { titleImage, titleImageSmall } = Astro.props;
---

<Layout>
  <script
    type="text/javascript"
    src="https://cdn.qtickets.tech/openapi.js"
    is:inline></script>
  <main class="min-h-screen">
    <!-- Hero Section -->
    <section
      class="relative h-screen min-h-[600px] flex items-center justify-center overflow-hidden px-4"
    >
      <!-- Background Image with Overlay -->
      <div class="absolute inset-0 -z-20">
        <picture>
          <source
            srcset={backgroundSmall.src}
            media="(max-width: 768px)"
            type="image/webp"
          />
          <img
            src={background.src}
            alt="Новогодний праздник ёлка и сказка в Москве - интерактивное представление для детей и взрослых"
            width="1024"
            height="1536"
            class="w-full h-full object-cover"
            loading="eager"
            decoding="sync"
          />
        </picture>
      </div>

      <!-- Sphere/Title -->
      <div
        class="relative w-full max-w-[600px] flex justify-center items-center group"
      >
        <picture>
          <source
            srcset={titleImageSmall.src}
            media="(max-width: 768px)"
            type="image/webp"
          />
          <img
            src={titleImage.src}
            alt="ёлка и сказка - новогодний празднк для всей семьи в Москве 2026"
            width="1024"
            height="1536"
            class="w-full h-auto object-contain drop-shadow-md"
            loading="eager"
            decoding="sync"
          />
        </picture>

        <!-- Button positioned inside the sphere (at the bottom) -->
        <div
          class="absolute bottom-[16%] left-1/2 -translate-x-1/2 z-10 w-48 p-0 hover:scale-105 transition-transform duration-300"
        >
          <a
            href="https://qtickets.ru/event/198955"
            class="qtickets-button qtickets-reset w-full h-auto block p-0 cursor-pointer focus:outline-none"
          >
            <img
              src={buyTicketsImage.src}
              alt="Купить билеты на ёлка и сказка - новогодний праздник в Москве 3, 4 и 5 января 2026"
              width="1536"
              height="1024"
              class="w-full h-auto drop-shadow-sm"
              loading="eager"
              decoding="sync"
            />
          </a>
        </div>
      </div>
    </section>

    <style is:global>
      /* Override injected QTickets styles */
      a.qtickets-button.qtickets-reset {
        background: transparent !important;
        border: none !important;
        /* width: auto !important;  <-- Removed to allow specific sizing */
        height: auto !important;
        border-radius: 100% !important;
        padding: 0 !important;
        margin: 0 !important;
        box-shadow: none !important;
        text-decoration: none !important;
        display: block !important;
        outline: none !important;
        font-size: inherit !important;
        line-height: inherit !important;
        color: inherit !important;
        border-radius: 0 !important;
      }

      /* Specific size for secondary button */
      a.qtickets-button.qtickets-reset.qtickets-secondary {
        width: 150px !important; /* Small but noticeble */
        transition: transform 0.3s ease;
      }

      a.qtickets-button.qtickets-reset.qtickets-secondary:hover {
        transform: scale(1.05);
      }

      /* Also reset hover/focus states */
      a.qtickets-button.qtickets-reset:hover,
      a.qtickets-button.qtickets-reset:focus {
        background: transparent !important;
        border: none !important;
        color: inherit !important;
      }
    </style>

    <style>
      /* Custom selection color for address badge */
      .address-badge::selection {
        background: #fbbf24; /* amber-400 */
        color: #78350f; /* amber-900 */
      }
      .address-badge::-moz-selection {
        background: #fbbf24;
        color: #78350f;
      }
    </style>

    <!-- Description Section -->
    <section
      class="px-6 pt-12 md:pt-16 pb-8 md:pb-12 bg-paper relative overflow-hidden"
    >
      <div class="max-w-2xl mx-auto relative">
        <div
          class="prose prose-lg prose-p:font-sans prose-p:text-ink/80 prose-headings:font-serif prose-headings:text-primary prose-headings:font-normal prose-a:text-clay prose-a:no-underline hover:prose-a:underline lowercase"
        >
          <Description />
        </div>
      </div>
    </section>

    <!-- Artists Section -->
    <section class="px-6 pt-8 md:pt-12 pb-16 md:pb-20 bg-paper">
      <div class="max-w-4xl mx-auto">
        <div class="relative inline-block w-full">
          <!-- Badge -->
          <div
            class="absolute -top-6 -right-4 z-10 bg-primary text-paper px-4 md:px-6 py-2 rounded-full font-serif italic text-lg shadow-lg rotate-3 lowercase max-w-[calc(100vw-3rem)] overflow-hidden truncate"
          >
            вот артисты и музыканты
          </div>

          <div class="relative overflow-hidden rounded-[2rem] shadow-xl group">
            <img
              src="/artists.jpg"
              alt="Артисты и музыканты новогоднего представления ёлка и сказка в Москве - профессиональные исполнители для детского праздника"
              width="1200"
              height="800"
              class="w-full h-auto grayscale group-hover:grayscale-0 transition-all duration-700 ease-in-out"
              loading="lazy"
              decoding="async"
            />
          </div>
        </div>
      </div>
    </section>

    <!-- Full-width Map Section -->
    <section class="px-0 pt-8 md:pt-12 pb-0 mb-0 bg-paper">
      <div class="relative">
        <!-- Address Badge -->
        <div
          class="absolute -top-2 left-4 bg-clay text-sand px-4 md:px-6 py-3 rounded-full font-serif italic text-lg shadow-lg -rotate-3 lowercase whitespace-nowrap select-text address-badge max-w-[calc(100vw-3rem)] overflow-hidden truncate"
        >
          склад №3 • малая семёновская 5с2, этаж 2
        </div>

        <iframe
          src="https://yandex.ru/map-widget/v1/?ll=37.706200,55.784572&z=17&pt=37.706200,55.784572&mode=whatshere"
          width="100%"
          height="400"
          frameborder="0"
          class="w-full h-[400px] border-0"
          allowfullscreen
        ></iframe>
      </div>
    </section>

    <!-- Social Links / Footer -->
    <section class="px-6 py-0 mt-0 bg-primary text-paper">
      <div class="max-w-4xl mx-auto">
        <!-- Mobile Layout: Social Links + Buy Button -->
        <div class="flex md:hidden justify-center items-center gap-6 py-3">
          <!-- Left Social Icon -->
          <a
            href="https://instagram.com/via_na_prazdnik"
            target="_blank"
            rel="noopener noreferrer"
            class="hover:text-clay transition-colors"
          >
            <SocialIcon type="instagram" />
          </a>

          <!-- Buy Button (Mobile Only) -->
          <div class="w-36 hover:scale-105 transition-transform duration-300">
            <a
              href="https://qtickets.ru/event/198955"
              class="qtickets-button qtickets-reset qtickets-secondary block p-0 cursor-pointer focus:outline-none"
            >
              <img
                src={buyTicketsImage.src}
                alt="Купить билеты на новогодний праздник ёлка и сказка в Москве - билеты онлайн qtickets"
                width="1536"
                height="1024"
                class="w-full h-auto drop-shadow-md"
                loading="lazy"
                decoding="async"
              />
            </a>
          </div>

          <!-- Right Social Icon -->
          <a
            href="https://t.me/povsemmestam"
            target="_blank"
            rel="noopener noreferrer"
            class="hover:text-clay transition-colors"
          >
            <SocialIcon type="telegram" />
          </a>
        </div>

        <!-- Copyright Row (Mobile Only) -->
        <div class="flex md:hidden justify-center py-3 text-sm font-sans tracking-wide lowercase opacity-80">
          <div class="text-paper/60">© 2025 мосмузсин</div>
        </div>

        <!-- Desktop Layout: All in one row using Grid -->
        <div class="hidden md:grid grid-cols-3 items-center py-3 text-sm font-sans tracking-wide lowercase opacity-80">
          <!-- Left: Social Icons -->
          <div class="flex gap-6 justify-start">
            <a
              href="https://instagram.com/via_na_prazdnik"
              target="_blank"
              rel="noopener noreferrer"
              class="hover:text-clay transition-colors"
            >
              <SocialIcon type="instagram" />
            </a>
            <a
              href="https://t.me/povsemmestam"
              target="_blank"
              rel="noopener noreferrer"
              class="hover:text-clay transition-colors"
            >
              <SocialIcon type="telegram" />
            </a>
          </div>

          <!-- Center: Buy Button -->
          <div class="flex justify-center">
            <div class="w-36 hover:scale-105 transition-transform duration-300">
              <a
                href="https://qtickets.ru/event/198955"
                class="qtickets-button qtickets-reset qtickets-secondary block p-0 cursor-pointer focus:outline-none"
              >
                <img
                  src={buyTicketsImage.src}
                  alt="Купить билеты на новогодний праздник ёлка и сказка в Москве - билеты онлайн qtickets"
                  width="1536"
                  height="1024"
                  class="w-full h-auto drop-shadow-md"
                  loading="lazy"
                  decoding="async"
                />
              </a>
            </div>
          </div>

          <!-- Right: Copyright -->
          <div class="text-paper/60 text-right">© 2025 мосмузсин</div>
        </div>
      </div>
    </section>
  </main>
</Layout>
